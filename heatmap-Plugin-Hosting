<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Widget de Forex Heatmap para cTrader</title>
    <style>
        /* Asegura que el widget ocupe toda la ventana sin márgenes */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden; /* Evita barras de desplazamiento no deseadas */
            background-color: #1e1e1e; /* Color de fondo que coincide con el tema oscuro */
            font-family: Arial, sans-serif;
            color: #ffffff;
        }
        
        /* Contenedor principal */
        .main-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }
        
        /* Panel de control superior */
        .control-panel {
            background-color: #2a2a2a;
            padding: 10px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #444;
            flex-wrap: wrap; /* Permite que los controles se ajusten en pantallas pequeñas */
        }
        
        /* Estilo para los selectores */
        .control-group {
            margin-right: 15px;
            margin-bottom: 5px; /* Espaciado inferior si se envuelve */
            display: flex;
            align-items: center;
        }

        .control-group label {
            margin-right: 5px;
        }
        
        select {
            background-color: #3a3a3a;
            color: #ffffff;
            border: 1px solid #555;
            padding: 5px 10px;
            border-radius: 4px;
        }
        
        /* Botón de actualización */
        .update-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-left: auto; /* Empuja el botón hacia la derecha */
        }
        
        .update-button:hover {
            background-color: #45a049;
        }
        
        /* El contenedor donde se inyectará el widget */
        #tradingview-widget-container {
            flex-grow: 1;
            width: 100%;
            height: 100%; /* Asegura que el contenedor del widget tenga una altura definida */
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Panel de control superior -->
        <div class="control-panel">
            <div class="control-group">
                <label for="theme-select">Tema:</label>
                <select id="theme-select">
                    <option value="dark">Oscuro</option>
                    <option value="light">Claro</option>
                </select>
            </div>
            <div class="control-group">
                <label for="range-select">Rango de Fechas:</label>
                <select id="range-select">
                    <option value="1D">1 Día</option>
                    <option value="1W">1 Semana</option>
                    <option value="1M">1 Mes</option>
                    <option value="YTD">Año hasta la fecha</option>
                    <option value="12M" selected>12 Meses</option>
                </select>
            </div>
            <div class="control-group">
                <label for="grid-select">Tamaño de Cuadrícula:</label>
                <select id="grid-select">
                    <option value="small">Pequeño</option>
                    <option value="medium">Mediano</option>
                    <option value="large" selected>Grande</option>
                </select>
            </div>
            <div class="control-group">
                <label for="sort-select">Ordenar Por:</label>
                <select id="sort-select">
                    <option value="Change" selected>Cambio (%)</option>
                    <option value="Name">Nombre</option>
                </select>
            </div>
            <button class="update-button" onclick="updateHeatmap()">Actualizar Mapa de Calor</button>
        </div>
        
        <!-- Este div es el ancla donde TradingView creará su widget -->
        <div id="tradingview-widget-container">
            <!-- El script de TradingView necesita esta estructura interna -->
            <div class="tradingview-widget-container__widget"></div>
        </div>
    </div>

    <script>
        /**
         * Función para actualizar el mapa de calor con la configuración seleccionada.
         */
        function updateHeatmap() {
            // Obtener los valores de los selectores
            const theme = document.getElementById('theme-select').value;
            const range = document.getElementById('range-select').value;
            const grid = document.getElementById('grid-select').value;
            const sort = document.getElementById('sort-select').value;

            // Log para depuración
            console.log("Actualizando Heatmap con:", { theme, range, grid, sort });

            // 1. Obtener el contenedor principal del widget.
            const container = document.getElementById('tradingview-widget-container');
            
            // 2. Limpiar el contenido anterior para evitar duplicados.
            //    Mantenemos el div interno 'tradingview-widget-container__widget'.
            const innerWidgetContainer = container.querySelector('.tradingview-widget-container__widget');
            container.innerHTML = '';
            container.appendChild(innerWidgetContainer);
            
            // 3. Crear un nuevo elemento <script> para el widget de TradingView.
            const script = document.createElement('script');
            script.type = 'text/javascript';
            script.async = true;
            script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-forex-heat-map.js';
            
            // 4. Definir la configuración del widget con los valores seleccionados.
            //    Usamos una altura fija para el widget para asegurar que se renderice correctamente.
            script.innerHTML = JSON.stringify({
                "width": "100%",
                "height": 500, // Altura fija para el widget en píxeles
                "locale": "es",
                "colorTheme": theme,
                "dateRange": range,
                "largeChartUrl": "",
                "isTransparent": false,
                "sortBy": sort,
                "gridSize": grid,
                "conserveMemory": true,
                "chartType": "area"
            });
            
            // 5. Añadir el nuevo script al contenedor principal.
            container.appendChild(script);
        }

        /**
         * Función para inicializar el widget con la configuración por defecto cuando la página se carga.
         */
        function initializeWidget() {
            // Llama a la función de actualización para cargar el widget por primera vez.
            updateHeatmap();
        }

        // Ejecuta la función de inicialización cuando la página esté completamente cargada.
        window.onload = initializeWidget;

    </script>
</body>
</html>
